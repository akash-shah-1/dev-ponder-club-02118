generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [vector]
}

model ai_answers {
  id         String    @id
  questionId String    @unique
  answer     String
  model      String
  images     String[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  questions  questions @relation(fields: [questionId], references: [id], onDelete: Cascade)
}

model ai_embeddings {
  id          String                 @id
  contentType String
  contentId   String
  content     String
  embedding   Unsupported("vector")?
  metadata    Json?
  createdAt   DateTime               @default(now())
  updatedAt   DateTime

  @@unique([contentType, contentId])
}

model ai_queries {
  id         String   @id
  questionId String
  userId     String?
  prompt     String
  response   String
  model      String
  tokensUsed Int
  confidence Float?
  wasHelpful Boolean?
  createdAt  DateTime @default(now())
}

model answers {
  id            String     @id
  content       String
  questionId    String
  authorId      String
  isAccepted    Boolean    @default(false)
  upvotes       Int        @default(0)
  downvotes     Int        @default(0)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime
  aiConfidence  Float?
  aiModel       String?
  isAiGenerated Boolean    @default(false)
  users         users      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  questions     questions  @relation(fields: [questionId], references: [id], onDelete: Cascade)
  comments      comments[]
}

model comments {
  id         String     @id
  content    String
  authorId   String
  questionId String?
  answerId   String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime
  answers    answers?   @relation(fields: [answerId], references: [id], onDelete: Cascade)
  users      users      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  questions  questions? @relation(fields: [questionId], references: [id], onDelete: Cascade)
}

model discussion_replies {
  id                       String               @id
  content                  String
  discussionId             String
  authorId                 String
  parentReplyId            String?
  upvotes                  Int                  @default(0)
  createdAt                DateTime             @default(now())
  updatedAt                DateTime
  users                    users                @relation(fields: [authorId], references: [id], onDelete: Cascade)
  discussions              discussions          @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  discussion_replies       discussion_replies?  @relation("discussion_repliesTodiscussion_replies", fields: [parentReplyId], references: [id])
  other_discussion_replies discussion_replies[] @relation("discussion_repliesTodiscussion_replies")
}

model discussions {
  id                 String               @id
  title              String
  content            String
  authorId           String
  category           String
  views              Int                  @default(0)
  upvotes            Int                  @default(0)
  isPinned           Boolean              @default(false)
  status             String               @default("open")
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  discussion_replies discussion_replies[]
  users              users                @relation(fields: [authorId], references: [id], onDelete: Cascade)
  tags               tags[]               @relation("DiscussionTags")
}

model follows {
  id                               String   @id
  followerId                       String
  followingId                      String
  createdAt                        DateTime @default(now())
  users_follows_followerIdTousers  users    @relation("follows_followerIdTousers", fields: [followerId], references: [id], onDelete: Cascade)
  users_follows_followingIdTousers users    @relation("follows_followingIdTousers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
}

model knowledge_articles {
  id          String   @id
  title       String
  content     String
  description String?
  category    String?
  authorId    String
  views       Int      @default(0)
  upvotes     Int      @default(0)
  readTime    Int      @default(5)
  status      String   @default("draft")
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [authorId], references: [id], onDelete: Cascade)
  tags        tags[]   @relation("KnowledgeArticleTags")
}

model notifications {
  id        String           @id
  userId    String
  type      NotificationType
  title     String
  message   String
  read      Boolean          @default(false)
  data      Json?
  createdAt DateTime         @default(now())
  users     users            @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model questions {
  id          String      @id
  title       String
  description String
  excerpt     String
  authorId    String
  category    String
  solved      Boolean     @default(false)
  views       Int         @default(0)
  upvotes     Int         @default(0)
  downvotes   Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  ai_answers  ai_answers?
  answers     answers[]
  comments    comments[]
  users       users       @relation(fields: [authorId], references: [id], onDelete: Cascade)
  saves       saves[]
  tags        tags[]      @relation("QuestionTags")
}

model saves {
  id         String    @id
  userId     String
  questionId String
  createdAt  DateTime  @default(now())
  questions  questions @relation(fields: [questionId], references: [id], onDelete: Cascade)
  users      users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, questionId])
}

model tag_watches {
  id        String   @id
  userId    String
  tagId     String
  createdAt DateTime @default(now())
  tags      tags     @relation(fields: [tagId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, tagId])
}

model tags {
  id                 String               @id
  name               String               @unique
  description        String?
  color              String?
  usageCount         Int                  @default(0)
  tag_watches        tag_watches[]
  discussions        discussions[]        @relation("DiscussionTags")
  knowledge_articles knowledge_articles[] @relation("KnowledgeArticleTags")
  questions          questions[]          @relation("QuestionTags")
}

model users {
  id                                 String               @id
  clerkId                            String               @unique
  email                              String               @unique
  name                               String
  avatar                             String?
  reputation                         Int                  @default(0)
  bio                                String?
  location                           String?
  website                            String?
  githubUrl                          String?
  twitterUrl                         String?
  linkedinUrl                        String?
  createdAt                          DateTime             @default(now())
  updatedAt                          DateTime
  dateOfBirth                        DateTime?
  isAdmin                            Boolean              @default(false)
  password                           String?
  answers                            answers[]
  comments                           comments[]
  discussion_replies                 discussion_replies[]
  discussions                        discussions[]
  follows_follows_followerIdTousers  follows[]            @relation("follows_followerIdTousers")
  follows_follows_followingIdTousers follows[]            @relation("follows_followingIdTousers")
  knowledge_articles                 knowledge_articles[]
  notifications                      notifications[]
  questions                          questions[]
  saves                              saves[]
  tag_watches                        tag_watches[]
  votes                              votes[]
}

model votes {
  id         String     @id
  type       VoteType
  userId     String
  targetId   String
  targetType TargetType
  createdAt  DateTime   @default(now())
  users      users      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, targetId, targetType])
}

enum NotificationType {
  ANSWER
  COMMENT
  VOTE
  BADGE
  MENTION
}

enum TargetType {
  QUESTION
  ANSWER
}

enum VoteType {
  UPVOTE
  DOWNVOTE
}
